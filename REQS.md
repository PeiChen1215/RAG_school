# 需求规格文档（REQS.md）

## 一、项目概述

项目名称：校园问答式 RAG（Retrieval-Augmented Generation）知识库

目标：构建基于校内文档的问答系统，用户可提交自然语言问题，系统通过向量检索查找相关片段并结合生成模型返回带来源引用的答案；提供可演示的交互式界面及必要的运维工具。

受众：校内师生（普通用户）、系统管理员（数据与索引管理）

## 二、范围与验收标准

- 范围（MVP）：
  - 批量摄取校园文档（TXT/PDF 已转文本），生成分段（chunk）与元数据。 
  - 使用嵌入模型生成向量并建立 Faiss 向量索引（示例文件：`data/faiss.index`）。
  - 提供检索+生成问答流程（Streamlit 演示界面）。
  - 提供基本管理操作：增量索引、重建索引、查看日志。

- 验收标准（可量化）：
  - 检索质量：初版目标 Recall@5 ≥ 0.8（以小规模标注集衡量）。
  - 答案质量：人工抽样准确率 ≥ 0.7（对事实型问题）。
  - 响应延迟：检索阶段平均 <1s（小数据规模），端到端短问题平均 <3s（受生成模型影响）。
  - 系统能在本地演示并完成完整问答流程（摄取→索引→检索→生成）。

## 三、功能性需求

1. 问答接口
   - 接受中文自然语言问题，返回答案、置信度提示和来源片段（带文档 id/标题/片段位置）。
   - 支持 top-k 配置（默认 k=5）。

2. 数据摄取与预处理
   - 支持读取 `data/raw/` 下的文档（TXT/已抽取文本），自动分段（分段长度与重叠可配置）。
   - 为每个片段生成元数据：`id, title, source, date, author, segment_id, text`，并保存到 `data/chunks.json` 与 `data/metadata.json`。
   - 做基础中文清洗（去空行、统一编码、去除噪音页眉页脚、基本去重）。

3. 嵌入与索引
   - 支持调用嵌入模型生成向量（可配置模型/API）；向量维度需记录在 metadata 中。
   - 使用 Faiss 作为默认向量库，支持保存/加载索引文件（`data/faiss.index`）。
   - 支持增量添加向量与重建索引。

4. 检索与重排
   - 基于向量相似度返回候选片段；可选基于关键词或 BM25 的混合检索（后续）。
   - 支持将若干高相关片段拼接成上下文传给生成模型；拼接策略可配置（按相似度或按文档聚合）。

5. 前端演示
   - 基于 Streamlit 提供简单交互：输入问题、显示答案、展示来源片段、查询历史。  

6. 管理与运维
   - 提供脚本或命令行接口执行数据摄取、索引构建、索引重建、索引导出/导入。
   - 记录基本日志（错误/摄取/查询统计）。

## 四、非功能性需求

- 语言：优先支持中文，文本处理与分词需兼容中文文本。
- 性能：MVP 在小规模（数百至数千文档）下满足上文延迟目标。生产级性能后续扩展。 
- 可用性：演示环境应易于本地运行，提供启动说明与依赖（`requirements.txt`）。
- 安全/隐私：在摄取过程中识别并标记敏感信息；对外展示时避免敏感字段。管理员权限控制（本地可通过简单密码/令牌机制）。

## 五、数据模型与文件约定

- 原始文档目录：`data/raw/`（下放文本文件或已抽取文本）。
- 分段与元数据：`data/chunks.json`（数组，每项包含 segment_id、text、source_id、offset 等）。
- 索引元信息：`data/metadata.json`（映射文档 id 到标题/源/日期/作者等）。
- 向量索引：`data/faiss.index`（Faiss 二进制索引文件），并备份向量对应表（segment_id -> vector_id）。

示例元数据字段：
```
{
  "doc_id": "doc-001",
  "title": "大赛预通知",
  "source": "教务处",
  "date": "2026-01-15",
  "author": "教务处",
  "segments": [ {"segment_id":"s-1","text":"..."}, ... ]
}
```

## 六、验收测试与评估指标

- 自动化/手动验收用例示例：
  1. 给定已知事实型问题，系统能返回包含正确来源的答案；人工评估正确/错误。 
  2. 摄取脚本能处理 `data/raw/` 中 N 个文档并生成 `chunks.json` 与更新索引。 
  3. 启动 `app/streamlit_app.py` 后可完成至少 10 次查询且无致命错误。

- 指标：Recall@k、MRR、端到端延迟、人工准确率（抽样）。

## 七、高层设计（MVP）

- 摄取模块（`scripts/ingest_run.py` / `src/ingest.py`）→ 文本清洗/分段 → 嵌入模块（`src/embed_index.py`）→ Faiss 索引（`data/faiss.index`）
- 检索服务（`src/qa.py`）→ 拼接上下文 → 生成模型 API（或本地模型）→ 前端 `app/streamlit_app.py`

## 八、里程碑（建议）

1. REQS 完成与评审（当前） — 1 天
2. 环境搭建与依赖安装（`requirements.txt` 验证） — 0.5 天
3. 数据摄取与 chunks 生成 — 1 天
4. 嵌入生成与 Faiss 索引构建 — 1 天
5. 检索+生成问答集成（Streamlit 演示） — 1 天
6. 验收测试与初步评估 — 1 天

## 九、交付物

- `REQS.md`（当前文档）
- 数据摄取脚本与示例 `data/chunks.json` / `data/metadata.json`
- 向量索引示例 `data/faiss.index`
- Streamlit 演示 `app/streamlit_app.py`
- 测试用例目录 `tests/`
- 运行与部署说明 `README.md` / `requirements.txt`

## 十、下一步（建议的短期动作）

1. 复核此 `REQS.md` 并确认验收指标与优先级。 
2. 我可继续将关键用例与用户故事写入 `REQS.md` 或独立的 `USE_CASES.md`（你选其一）。
3. 或者我现在开始搭建环境并运行现有 demo（`requirements.txt` → `app/streamlit_app.py`）。

---

（文档结束）
